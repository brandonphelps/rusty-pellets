{% extends "base.html" %}

{% block content %}

<div id="root"></div>
<canvas id="tutorial" width="640" height="480"></canvas>

{% endblock content %}


{% block script_content %}

<script>

  const canvas = document.querySelector("#tutorial");
  const ctx = canvas.getContext("2d");
  const image_data = ctx.getImageData;

  var web_sock = new WebSocket('ws://' + window.location.host + '/ws_image');

  web_sock.onopen = () => {
      console.log("Image data websocket opened");
  }
  var temp_data;

  web_sock.onmessage = function(event) {
      var data = event.data;
      temp_data = event;

      const out_data = JSON.parse(event.data);
      const height = out_data.height;
      const width = out_data.width;

      const imageData = ctx.getImageData(0, 0, width, height);
      // this does nothing. 
      // imageData.data = out_data.data;

      // why is this needed?
      for(let i = 0; i < out_data.data.length; i += 1) {
	  imageData.data[i] = out_data.data[i];
      }

      ctx.putImageData(imageData, 0, 0);
  }

  web_sock.onclose = function(event) {
      console.log("image data websocket closed");
  }
</script>

{% endblock script_content %}

